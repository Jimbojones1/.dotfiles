#!/usr/bin/env bash
#
# bootstrap-repos  â€“  initialise & push local dirs to GitHub Enterprise
#
# Prerequisites
#   â€¢ gh CLI already authenticated for git.generalassemb.ly
#   â€¢ git installed
#
# Usage
#   bootstrap-repos dir1 dir2 â€¦          # push each listed folder
#   bootstrap-repos *                    # push every folder in the cwd

set -euo pipefail

HOST="git.generalassemb.ly"
ORG="Deloitte-AI-and-Data-Bootcamp"

if [[ $# -eq 0 ]]; then
  echo "Usage: $0 <folder> [folder â€¦]" >&2
  exit 1
fi

for dir in "$@"; do
  [[ -d $dir ]] || { echo "âŒ  $dir is not a directory â€“ skipping"; continue; }

  repo="$(basename "$dir")"
  (
    cd "$dir"

    # 1 â–ª Initialise if needed
    if [[ ! -d .git ]]; then
      echo "ðŸ†•  Initialising $repo"
      git init -q
    fi

    # 2 â–ª Stage everything
    git add .

    # 3 â–ª Commit only if thereâ€™s nothing yet
    if ! git rev-parse --quiet --verify HEAD >/dev/null; then
      git commit -m "Initial commit"
    fi

    # 4 â–ª Create the remote repo if it doesnâ€™t exist
    if ! gh repo view "$ORG/$repo" --hostname "$HOST" &>/dev/null; then
      echo "ðŸ“Œ  Creating $ORG/$repo on $HOST"
      gh repo create "$ORG/$repo" \
        --internal \
        --source . \
        --remote origin \
        --push 
    else
      # Add remote if missing, then push
      if ! git remote | grep -q '^origin$'; then
        git remote add origin "git@$HOST:$ORG/$repo.git"
      fi
      echo "ðŸ”„  Pushing $repo"
      git push -u origin main   # change â€˜mainâ€™ if your default branch differs
    fi
  )
done

